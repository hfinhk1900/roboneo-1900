# OpenAI 前端 API 测试指南

## 🎯 测试目标
在前端正式集成 OpenAI gpt-image-1 API 进行 image-to-sticker 生成测试。

## ✅ 环境准备完成

### 1. API 配置 ✅
- **端点**: `/api/image-to-sticker` (OpenAI gpt-image-1)
- **模式**: 真实 API（已禁用 MOCK 模式）
- **OpenAI Key**: 已配置 ✅
- **存储**: R2 Cloud Storage 已配置 ✅

### 2. 前端组件 ✅
- **Sticker 生成器**: `src/components/blocks/sticker/sticker-generator.tsx`
- **API 调用**: 正确使用 `/api/image-to-sticker`
- **界面**: 已优化（删除绿色提示框）

### 3. 服务器状态 ✅
- **端口**: 3000 (按用户偏好)
- **状态**: 运行中 ✅
- **访问**: http://localhost:3000

## 🚀 开始测试

### 方式一: 浏览器界面测试 (推荐)

1. **访问网站**:
   ```
   http://localhost:3000
   ```

2. **登录账户**:
   - 点击右上角 "Login" 按钮
   - 使用您的账户登录 (需要认证才能使用 API)

3. **测试贴纸生成**:
   - 在 Sticker 页面生成器区域上传图片
   - 选择风格：iOS, Pixel Art, LEGO, Snoopy
   - 点击 "Generate Sticker" 按钮
   - 等待约 30-40 秒

### 方式二: API 直接测试

使用我们准备的测试脚本：

```bash
# 注意：需要先在浏览器登录以获得 session
npx tsx scripts/test-openai-frontend.ts
```

## 📊 测试期望结果

### ✅ 成功情况
- **处理时间**: 30-40 秒
- **成本**: ~$0.042 USD 每张
- **输出**: 1024x1024 PNG 图片
- **存储**: 自动保存到 R2 云存储
- **下载**: 可直接下载生成的贴纸

### 🎨 支持的风格

1. **iOS 风格**: Apple 风格 3D 头像贴纸
2. **Pixel Art**: 复古像素艺术风格
3. **LEGO**: 乐高小人风格
4. **Snoopy**: 史努比卡通风格

## 🔧 故障排除

### 问题 1: 认证失败 (401)
**解决**: 确保已在浏览器中登录账户

### 问题 2: 积分不足 (402)
**解决**: 检查账户积分余额，每张贴纸消耗一定积分

### 问题 3: 生成失败 (500)
**解决**:
- 检查图片格式 (支持 JPEG, PNG, WebP)
- 图片大小 ≤ 4MB
- 检查 OpenAI API Key 是否有效

### 问题 4: 处理时间过长
**正常**: OpenAI gpt-image-1 需要 30-40 秒处理时间

## 💡 测试技巧

1. **选择合适的测试图片**:
   - 清晰的人脸照片效果最佳
   - 避免过于复杂的背景
   - 建议使用 public/hero-1.webp 作为测试

2. **测试不同风格**:
   - iOS: 最接近真实头像
   - Pixel: 怀旧游戏风格
   - LEGO: 可爱卡通效果
   - Snoopy: 温馨漫画风格

3. **性能监控**:
   - 观察响应时间
   - 检查生成质量
   - 验证下载功能

## 📱 移动端测试

在不同设备上测试：
- iPhone Safari
- Android Chrome
- iPad Safari
- 桌面浏览器

## 🎉 预期体验流程

1. 用户访问首页 → 看到 Hero 区域
2. 上传图片 → 立即显示预览
3. 选择风格 → 样式选择器高亮
4. 点击生成 → 显示进度指示器
5. 等待处理 → 进度条和状态更新
6. 生成完成 → 显示结果和下载按钮
7. 下载贴纸 → 保存到用户设备

## 💰 成本控制

- **开发测试**: 建议限制在 5-10 次生成
- **每次成本**: $0.042 USD
- **质量设置**: Medium (性价比最优)
- **监控**: 观察 OpenAI API 使用量

---

**🚀 准备完成！您现在可以开始前端 OpenAI API 测试了！**

访问: http://localhost:3000 开始测试
