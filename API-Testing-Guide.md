# Image-to-Sticker API æµ‹è¯•å’Œä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

ç¡®ä¿åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# Laozhang AI API é…ç½®
LAOZHANG_API_BASE="https://api.laozhang.ai/v1"
LAOZHANG_API_KEY="your-api-key-here"
```

### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

## ğŸ§ª API æµ‹è¯•æ–¹æ³•

### æ–¹æ³• 1: ä½¿ç”¨æµ‹è¯•è„šæœ¬

è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼š

```bash
npx tsx scripts/test-image-api.ts
```

### æ–¹æ³• 2: ä½¿ç”¨ curl

```bash
curl -X POST http://localhost:3000/api/image-to-sticker \
  -F "imageFile=@/path/to/your/image.png" \
  -F "style=ios"
```

### æ–¹æ³• 3: ä½¿ç”¨ Postman æˆ–ç±»ä¼¼å·¥å…·

- **URL**: `POST http://localhost:3000/api/image-to-sticker`
- **Content-Type**: `multipart/form-data`
- **Body**:
  - `imageFile`: (æ–‡ä»¶) é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶
  - `style`: (æ–‡æœ¬) å¯é€‰å€¼: `ios`, `pixel`, `lego`, `snoopy`

## ğŸ“Š API æ¥å£è¯¦æƒ…

### è¯·æ±‚æ ¼å¼

**ç«¯ç‚¹**: `POST /api/image-to-sticker`

**è¯·æ±‚å¤´**:
```
Content-Type: multipart/form-data
```

**è¯·æ±‚ä½“** (FormData):
```typescript
{
  imageFile: File,  // å¿…éœ€ï¼Œæ”¯æŒ JPEG, PNG, WebPï¼Œæœ€å¤§ 4MB
  style: string     // å¯é€‰ï¼Œé»˜è®¤ 'ios'ï¼Œå¯é€‰å€¼: 'ios', 'pixel', 'lego', 'snoopy'
}
```

### å“åº”æ ¼å¼

**æˆåŠŸå“åº”** (200):
```typescript
{
  url?: string,           // ç”Ÿæˆçš„è´´çº¸å›¾ç‰‡ URL
  description?: string,   // AI ç”Ÿæˆçš„æè¿°æ–‡æœ¬
  seed?: number,          // éšæœºç§å­
  width?: number,         // å›¾ç‰‡å®½åº¦ (é€šå¸¸ 512)
  height?: number,        // å›¾ç‰‡é«˜åº¦ (é€šå¸¸ 512)
  isHighQuality?: boolean,// æ˜¯å¦é«˜è´¨é‡æ¨¡å¼
  style?: string,         // ä½¿ç”¨çš„æ ·å¼
  cost?: number,          // ä¼°ç®—æˆæœ¬ (ç¾å…ƒ)
  tokenUsage?: {          // Token ä½¿ç”¨è¯¦æƒ…
    prompt_tokens: number,
    completion_tokens: number,
    total_tokens: number
  }
}
```

**é”™è¯¯å“åº”** (4xx/5xx):
```typescript
{
  error: string  // é”™è¯¯æè¿°
}
```

## ğŸ¨ æ”¯æŒçš„æ ·å¼

| æ ·å¼ | æè¿° | æç¤ºè¯ |
|------|------|--------|
| `ios` | iOS è´´çº¸é£æ ¼ | å¯çˆ±çš„ iOS è´´çº¸é£æ ¼ï¼Œç®€æ´çš„ç™½è‰²è½®å»“çº¿ |
| `pixel` | åƒç´ è‰ºæœ¯é£æ ¼ | 8ä½å¤å¤ç¾å­¦ï¼Œå—çŠ¶åƒç´ ï¼Œæœ‰é™è‰²å½©è°ƒè‰²æ¿ |
| `lego` | ä¹é«˜é£æ ¼ | å—çŠ¶æ„é€ ï¼Œå¡‘æ–™å¤–è§‚ï¼Œæ˜äº®çš„ä¸»è‰²è°ƒ |
| `snoopy` | å²åŠªæ¯”å¡é€šé£æ ¼ | ç®€å•çº¿æ¡ï¼Œæç®€è®¾è®¡ï¼Œè¿·äººå¯çˆ± |

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

åœ¨æµ‹è¯•æ—¶ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

### âœ… åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] API æ˜¯å¦æ­£å¸¸å“åº” (çŠ¶æ€ç  200)
- [ ] è¿”å›çš„ JSON æ ¼å¼æ˜¯å¦æ­£ç¡®
- [ ] ç”Ÿæˆçš„å›¾ç‰‡ URL æ˜¯å¦å¯è®¿é—®
- [ ] ä¸åŒæ ·å¼æ˜¯å¦ç”Ÿæˆä¸åŒç»“æœ

### âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- [ ] æ— æ–‡ä»¶ä¸Šä¼ æ—¶è¿”å› 400 é”™è¯¯
- [ ] ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹è¿”å› 400 é”™è¯¯
- [ ] æ–‡ä»¶è¿‡å¤§æ—¶è¿”å› 400 é”™è¯¯
- [ ] API Key é”™è¯¯æ—¶è¿”å› 401 é”™è¯¯

### âœ… æ€§èƒ½æµ‹è¯•
- [ ] å“åº”æ—¶é—´æ˜¯å¦åœ¨åˆç†èŒƒå›´å†… (< 30ç§’)
- [ ] Token ä½¿ç”¨é‡æ˜¯å¦ç¬¦åˆé¢„æœŸ
- [ ] æˆæœ¬ä¼°ç®—æ˜¯å¦å‡†ç¡®

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. API Key é”™è¯¯**
```
é”™è¯¯: Invalid API key or authentication failed
è§£å†³: æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ LAOZHANG_API_KEY æ˜¯å¦æ­£ç¡®
```

**2. æ–‡ä»¶æ ¼å¼é”™è¯¯**
```
é”™è¯¯: File type not supported
è§£å†³: ç¡®ä¿ä½¿ç”¨ JPEG, PNG æˆ– WebP æ ¼å¼çš„å›¾ç‰‡
```

**3. æ–‡ä»¶è¿‡å¤§**
```
é”™è¯¯: File size exceeds the 4MB limit
è§£å†³: å‹ç¼©å›¾ç‰‡æˆ–ä½¿ç”¨è¾ƒå°çš„å›¾ç‰‡æ–‡ä»¶
```

**4. ç½‘ç»œè¶…æ—¶**
```
é”™è¯¯: Request timeout
è§£å†³: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–ç¨åé‡è¯•
```

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—**: åœ¨ç»ˆç«¯ä¸­è§‚å¯Ÿè¯¦ç»†çš„è¯·æ±‚/å“åº”æ—¥å¿—
2. **æ£€æŸ¥ç¯å¢ƒå˜é‡**: ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡éƒ½å·²è®¾ç½®
3. **æµ‹è¯•ç½‘ç»œè¿æ¥**: ç¡®ä¿å¯ä»¥è®¿é—® `https://api.laozhang.ai`
4. **ä½¿ç”¨å¼€å‘æ¨¡å¼**: åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ç®€åŒ–çš„æç¤ºè¯æ¥èŠ‚çœæˆæœ¬

## ğŸ’° æˆæœ¬ä¼˜åŒ–å»ºè®®

### å¼€å‘é˜¶æ®µ
- ä½¿ç”¨ `NODE_ENV=development` å¯ç”¨ç®€åŒ–æç¤ºè¯
- ä½¿ç”¨è¾ƒå°çš„æµ‹è¯•å›¾ç‰‡
- é™åˆ¶æµ‹è¯•é¢‘ç‡

### ç”Ÿäº§é˜¶æ®µ
- å®ç°è¯·æ±‚ç¼“å­˜æœºåˆ¶
- è®¾ç½®åˆç†çš„æ–‡ä»¶å¤§å°é™åˆ¶
- ç›‘æ§ Token ä½¿ç”¨é‡å’Œæˆæœ¬

## ğŸ” æ—¥å¿—ç›‘æ§

API æä¾›è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼ŒåŒ…æ‹¬ï¼š
- è¯·æ±‚æ¥æ”¶å’Œå¤„ç†çŠ¶æ€
- æ–‡ä»¶éªŒè¯å’Œè½¬æ¢è¿‡ç¨‹
- ä¸ Laozhang AI çš„é€šä¿¡è¯¦æƒ…
- Token ä½¿ç”¨é‡å’Œæˆæœ¬åˆ†æ
- é”™è¯¯è¯¦æƒ…å’Œè°ƒè¯•ä¿¡æ¯

è§‚å¯Ÿè¿™äº›æ—¥å¿—å¯ä»¥å¸®åŠ©æ‚¨ï¼š
- è¯Šæ–­é—®é¢˜
- ä¼˜åŒ–æ€§èƒ½
- ç›‘æ§æˆæœ¬
- æ”¹è¿›ç”¨æˆ·ä½“éªŒ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Laozhang AI API é›†æˆæŒ‡å—](./Laozhang-AI-API-Integration-Guide.md)
- [API æ–¹æ¡ˆæ–‡æ¡£](./API%20æ–¹æ¡ˆ.md)
- [API å®ç°ä»»åŠ¡æ¸…å•](./API%20å®ç°ä»»åŠ¡æ¸…å•.md)
